#!/usr/bin/env ruby

require 'bundler/setup'
require 'redux_ussd'

class HelloWorld
  include ReduxUssd

  menu do
    screen :index do
      text 'Accept terms and conditions?'
      option :yes, text: 'Yes'
      option :no, text: 'No'

      after do |state|
        push :welcome
      end
    end

    screen :welcome do
      text 'Welcome to test service'
      option :deposit, text: 'Deposit money'
      option :balance, text: 'Balance'

      after do |state|
        push state[:options][:option]
      end
    end

    screen :deposit do
      prompt :amount, text: 'How much?'

      after do |state|
        push :deposit_success
      end
    end

    screen :deposit_success do
      text "Successfully deposited #{state[:prompt][:values][:amount]}AR"
    end
  end
end

hello_world = HelloWorld.new
hello_world.setup_menu
while true
  print '>> '
  input = gets.strip
  hello_world.menu.handle_raw_input(input)

  puts hello_world.menu.render
  break if hello_world.menu.end?
end
