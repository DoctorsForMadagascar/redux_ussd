#!/usr/bin/env ruby

require 'bundler/setup'
require 'redux_ussd'

class HelloWorld
  include ReduxUssd

  menu do
    screen :index, initial: true do
      text 'Welcome to test service'
      option :deposit, text: 'Deposit money'
      option :send, text: 'Send money to someone else'
      option :balance, text: 'Check your balance'
    end

    screen :deposit do
      prompt :amount, text: 'How much?'

      after do |state|
        print state
        push :deposit_success
      end
    end

    screen :deposit_success do
      text "Successfully deposited #{state[:prompt][:amount]}AR"

      after do |state|
      end
    end

    def initial_state
      {
          navigation: {
              current_screen: :index,
              routes: {}
          },
          prompt: {}
      }
    end
  end
end

hello_world = HelloWorld.new
stop = false
until stop
  #stop = hello_world.menu.end?
  puts hello_world.menu.render
  print '>> '
  input = gets.strip
  hello_world.menu.handle_raw_input(input)
end
